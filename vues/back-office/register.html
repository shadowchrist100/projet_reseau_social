<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administrateur des inscriptions</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" />
    <style>
      :where([class^="ri-"])::before { content: "\f3c2"; }
      body {
      background-color: #f9fafb;
      font-family: 'Inter', sans-serif;
      }
      .form-group input, .form-group select {
      transition: border-color 0.2s ease;
      background-color: white;
      }
      .form-group input:focus, .form-group select:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 1.5em 1.5em;
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#475569", secondary: "#94a3b8" },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
          },
        },
      };
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="bg-primary text-white p-6">
            <div class="flex items-center justify-center mb-2">
                <div class="w-12 h-12 flex items-center justify-center bg-white/20 rounded-full">
                    <i class="ri-shield-user-line text-xl"></i>
                </div>
            </div>
            <h1 class="text-2xl font-bold text-center">Création compte Admin</h1>
            <p class="text-center text-white/80 mt-2">
                Créez un nouveau compte administrateur
            </p>
        </div>
        <div class="p-6">
            <form id="adminRegisterForm" class="space-y-5">
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="adminFirstName" class="block text-sm font-medium text-gray-700 mb-1">Prénom</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="ri-user-line text-gray-400"></i>
                            </div>
                            <input type="text" id="adminFirstName" class="pl-10 w-full h-11 px-4 border border-gray-300 rounded focus:ring-primary focus:border-primary" required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="adminLastName" class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="ri-user-line text-gray-400"></i>
                            </div>
                            <input type="text" id="adminLastName" class="pl-10 w-full h-11 px-4 border border-gray-300 rounded focus:ring-primary focus:border-primary" required />
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="adminEmail" class="block text-sm font-medium text-gray-700 mb-1">Email professionnel</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="ri-mail-line text-gray-400"></i>
                        </div>
                        <input type="email" id="adminEmail" class="pl-10 w-full h-11 px-4 border border-gray-300 rounded focus:ring-primary focus:border-primary" required />
                    </div>
                </div>
                <div class="form-group">
                    <label for="adminPassword" class="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="ri-lock-line text-gray-400"></i>
                        </div>
                        <input type="password" id="adminPassword" minlength="8" class="pl-10 w-full h-11 px-4 border border-gray-300 rounded focus:ring-primary focus:border-primary" required />
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                            <button type="button" id="togglePassword" class="text-gray-400 hover:text-gray-600 focus:outline-none">
                                <i class="ri-eye-off-line"></i>
                            </button>
                        </div>
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Le mot de passe doit contenir au moins 8 caractères
                    </p>
                </div>
                <div class="form-group">
                    <label for="adminRole" class="block text-sm font-medium text-gray-700 mb-1">Rôle</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="ri-user-settings-line text-gray-400"></i>
                        </div>
                        <select id="adminRole" class="pl-10 w-full h-11 px-4 pr-8 border border-gray-300 rounded focus:ring-primary focus:border-primary" required>
                            <option value="">Sélectionnez un rôle</option>
                            <option value="admin">Administrateur</option>
                            <option value="moderator">Modérateur</option>
                        </select>
                    </div>
                </div>
                <div class="pt-2">
                    <button type="submit" class="w-full flex items-center justify-center bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-button transition-colors whitespace-nowrap">
                        <i class="ri-user-add-line mr-2"></i>
                        Créer le compte
                    </button>
                </div>
                <div class="text-center text-sm text-gray-500 mt-4">
                    <a href="login.html" class="text-primary hover:underline">Retour à la page de connexion</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Gestion de la visibilité du mot de passe
        document.addEventListener("DOMContentLoaded", function () {
            const togglePassword = document.getElementById("togglePassword");
            const passwordInput = document.getElementById("adminPassword");
            
            togglePassword.addEventListener("click", function () {
                const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
                passwordInput.setAttribute("type", type);
                const iconElement = togglePassword.querySelector("i");
                if (type === "password") {
                    iconElement.classList.remove("ri-eye-line");
                    iconElement.classList.add("ri-eye-off-line");
                } else {
                    iconElement.classList.remove("ri-eye-off-line");
                    iconElement.classList.add("ri-eye-line");
                }
            });

            // Gestion de l'inscription
            const form = document.getElementById("adminRegisterForm");
            
            form.addEventListener("submit", async function (event) {
                event.preventDefault();
                
                const formData = {
                    firstName: document.getElementById("adminFirstName").value.trim(),
                    lastName: document.getElementById("adminLastName").value.trim(),
                    email: document.getElementById("adminEmail").value.trim(),
                    password: document.getElementById("adminPassword").value,
                    role: document.getElementById("adminRole").value
                };

                // Validation basique
                if (!formData.firstName || !formData.lastName || !formData.email || !formData.password || !formData.role) {
                    alert("Veuillez remplir tous les champs requis");
                    return;
                }

                if (formData.password.length < 8) {
                    alert("Le mot de passe doit contenir au moins 8 caractères");
                    return;
                }

                try {
                    const response = await fetch('../../api/admin/register.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert("Compte administrateur créé avec succès!");
                        window.location.href = `login.html?registered=1&email=${encodeURIComponent(formData.email)}`;
                    } else {
                        alert(data.message || "Erreur lors de la création du compte");
                    }
                } catch (error) {
                    console.error('Erreur:', error);
                    alert("Erreur de connexion au serveur");
                }
            });
        });
    </script>
</body>
</html>